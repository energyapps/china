---
layout: post
---

<style>

.graticule {
  fill: #fff;
  /*fill-opacity: 0.2;*/
  stroke: #ce008d;
}

.boundary {
  fill: rgb(141,206,0);
  fill-opacity: 1;
  stroke: #fff;
}

</style>
<body>
If you want to create awesome <a href="" target="_blank">D3 Satellite maps</a>, you're going to need to fiddle with the parameters to get the zoom and angles right. If you want to read up more on the rather esoteric names of each of these (below) check out the D3 geo projections documentation. 

<br><br>

  distance: <input type="text" id="mydistance" value="20">
  scale: <input type="text" id="myscale" value="1500"><br>
  <a target="_blank" href="http://bl.ocks.org/mbostock/4282586">Rotation of the globe</a>:
  yaw (λ): <input type="text" id="myyaw" value="-115">
  pitch (φ): <input type="text" id="mypitch" value="15">
  roll (γ): <input type="text" id="myroll" value="15"><br>
  Center (x): <input type="text" id="mycenterx" value="-10">
  Center (y): <input type="text" id="mycentery" value="55"><br>
  tilt: <input type="text" id="mytilt" value="20">precision: <input type="text" id="myprecision" value="0.1"><br>
  Clip to Horizon: 
  <input type="radio" name="horizon" checked="checked" id="horizon_yes" value="yes">Yes<input type="radio" name="horizon" id="horizon_no" value="no">No<br>
  <div id="myclipangle_container">
    If no, select a ClipAngle between 0 and 180: <input type="text" id="myclipangle" value="90">
  </div>
  Longitude Graticule intreval: <input type="text" id="mygraticulex" value="6">
  Latitude Graticule intreval: <input type="text" id="mygraticuley" value="6">
<p>Click to redraw the map.</p>

<button onclick="clickFunction()">Try it</button>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

var width = 1000,
    height = 1000;         

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var no = document.getElementById('horizon_no');
var yes = document.getElementById('horizon_yes');

no.onclick = function() {
  document.getElementById("myclipangle_container").style.visibility = "visible";
}
yes.onclick = function() {
  document.getElementById("myclipangle_container").style.visibility = "hidden";
}


// When clicked (or on first load), set the parameters from the boxes, then build the map
function clickFunction() {

document.getElementById("myclipangle_container").style.visibility = "hidden";

  var distance = document.getElementById("mydistance").value;
  var scale = document.getElementById("myscale").value;
  var yaw = document.getElementById("myyaw").value;
  var pitch = document.getElementById("mypitch").value;
  var roll = document.getElementById("myroll").value;
  var centerx = document.getElementById("mycenterx").value;
  var centery = document.getElementById("mycentery").value;
  var tilt = document.getElementById("mytilt").value;
  var precision = document.getElementById("myprecision").value;
  var graticulex = document.getElementById("mygraticulex").value;
  var graticuley = document.getElementById("mygraticuley").value;

  if(document.getElementById('horizon_yes').checked) {
    console.log('yes')
    var clipAngle = Math.acos(1 / distance) * 180 / Math.PI - 1e-6;
    console.log(clipAngle)
  }else if(document.getElementById('horizon_no').checked) {
    var clipAngle = document.getElementById("myclipangle").value;
  }

  // var projection = d3.geo.satellite()
    var projection = d3.geo.satellite()
      .distance(distance)
      .scale(scale)    
      .center([centerx, centery])
      .tilt(tilt)
      .clipAngle(clipAngle)
      .precision(precision)
      .rotate([yaw, pitch, roll]) //yaw, pitch, roll    ;    

  var graticule = d3.geo.graticule()
    // .extent([[-93, 0.49], [170.61, 90]])
    // .extent([-36,-110.50],[-47,57])
    .step([graticulex, graticuley]);

  buildMap(projection, graticule);
}  

function buildMap(projection, graticule) {
console.log('Build Map')
d3.json("js/world_50m.json", function(error, world) {
  if (error) return console.error(error);

  d3.select("body").selectAll(".place-label").data([]).exit().remove();
  d3.select("body").selectAll("path").data([]).exit().remove();  

var path = d3.geo.path()
  .projection(projection);

  svg.append("path")
    .datum(graticule)
    .attr("class", "graticule")
    .attr("d", path);

  svg.append("path")
      .datum(topojson.feature(world, world.objects.us_50m_world  ))
      .attr("class", "boundary")
      .attr("d", path);

  svg.append("path")
      .datum(topojson.feature(world, world.objects.china_cities_places3))
      .attr("d", path)
      .attr("class", "place");

  svg.selectAll(".place-label")
      .data(topojson.feature(world, world.objects.china_cities_places3).features)
    .enter().append("text")
    .attr("class", "place-label")
    .attr("transform", function(d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
    .attr("dy", ".35em")
    .text(function(d) { return d.properties.name; });

    });

};


d3.select(self.frameElement).style("height", height + "px");

window.onload= clickFunction();

// d3.json("js/us-land.json", function(error, us) {
//   svg.append("path")
//       .datum(topojson.feature(us, us.objects.land))
//       .attr("class", "boundary")
//       .attr("d", path);
// });


</script>
